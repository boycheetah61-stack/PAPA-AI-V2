<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced AI Chat</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f0f0f;
  color:white;
}
header{
  background:#111;
  padding:15px;
  text-align:center;
  font-size:20px;
  border-bottom:1px solid #222;
}
.container{
  padding:15px;
}
#chat{
  height:350px;
  overflow-y:auto;
  border:1px solid #222;
  padding:10px;
  border-radius:10px;
  background:#151515;
}
.message{
  margin:8px 0;
  padding:8px 12px;
  border-radius:8px;
  max-width:80%;
}
.user{
  background:#1e88e5;
  align-self:flex-end;
}
.ai{
  background:#333;
}
.input-area{
  margin-top:10px;
  display:flex;
}
input{
  flex:1;
  padding:10px;
  border:none;
  border-radius:8px;
  margin-right:5px;
}
button{
  padding:10px;
  border:none;
  border-radius:8px;
  background:#1e88e5;
  color:white;
}
.settings{
  background:#111;
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
}
select, textarea{
  width:100%;
  margin-top:5px;
  margin-bottom:10px;
  padding:8px;
  border-radius:6px;
  border:none;
}
.small-btn{
  background:#444;
  margin-top:5px;
}
</style>
</head>
<body>

<header>⚡ Advanced Custom AI</header>

<div class="container">

<div class="settings">
<h3>⚙ Settings</h3>

<label>API Key</label>
<input type="password" id="apiKey" placeholder="Enter API Key">

<label>Model</label>
<select id="model">
<option value="gpt-4o-mini">gpt-4o-mini</option>
<option value="gpt-4o">gpt-4o</option>
</select>

<label>Temperature (Creativity)</label>
<select id="temperature">
<option value="0.2">0.2 (Serious)</option>
<option value="0.7" selected>0.7 (Balanced)</option>
<option value="1">1 (Creative)</option>
</select>

<label>System Prompt (AI Personality)</label>
<textarea id="systemPrompt" rows="3">You are a helpful assistant.</textarea>

<button onclick="saveSettings()">Save Settings</button>
<button class="small-btn" onclick="clearChat()">Clear Chat</button>

</div>

<div id="chat"></div>

<div class="input-area">
<input type="text" id="userInput" placeholder="Type message...">
<button onclick="sendMessage()">Send</button>
</div>

</div>

<script>

let messages = JSON.parse(localStorage.getItem("chatHistory")) || [];

function saveSettings(){
  localStorage.setItem("apiKey", document.getElementById("apiKey").value);
  localStorage.setItem("model", document.getElementById("model").value);
  localStorage.setItem("temperature", document.getElementById("temperature").value);
  localStorage.setItem("systemPrompt", document.getElementById("systemPrompt").value);
  alert("Settings Saved!");
}

function renderChat(){
  const chatDiv = document.getElementById("chat");
  chatDiv.innerHTML = "";
  messages.forEach(msg=>{
    const div = document.createElement("div");
    div.className = "message " + (msg.role==="user"?"user":"ai");
    div.innerText = msg.content;
    chatDiv.appendChild(div);
  });
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

function clearChat(){
  messages = [];
  localStorage.removeItem("chatHistory");
  renderChat();
}

async function sendMessage(){
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if(!text) return;

  const apiKey = localStorage.getItem("apiKey");
  if(!apiKey){
    alert("Add API Key in Settings!");
    return;
  }

  messages.push({role:"user", content:text});
  renderChat();
  input.value="";

  const typingDiv = document.createElement("div");
  typingDiv.className="message ai";
  typingDiv.innerText="Typing...";
  document.getElementById("chat").appendChild(typingDiv);

  const model = localStorage.getItem("model") || "gpt-4o-mini";
  const temperature = parseFloat(localStorage.getItem("temperature")) || 0.7;
  const systemPrompt = localStorage.getItem("systemPrompt") || "You are a helpful assistant.";

  const fullMessages = [
    {role:"system", content:systemPrompt},
    ...messages
  ];

  try{
    const response = await fetch("https://7dfd7c14-9377-4d2e-9c2b-c434e1890a0a-00-12jxbas0hnc2k.pike.replit.dev/",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer "+apiKey
      },
      body: JSON.stringify({
        model:model,
        messages:fullMessages,
        temperature:temperature
      })
    });

    const data = await response.json();
    typingDiv.remove();

    const reply = data.choices[0].message.content;
    messages.push({role:"assistant", content:reply});
    localStorage.setItem("chatHistory", JSON.stringify(messages));
    renderChat();

  }catch(err){
    typingDiv.innerText="Error connecting to AI.";
  }
}

document.getElementById("userInput").addEventListener("keydown", function(e){
  if(e.key==="Enter"){
    sendMessage();
  }
});

renderChat();

</script>

</body>
</html>
